# AGLãŒæä¾›ã™ã‚‹æ©Ÿèƒ½ vs å®Ÿè£…ãŒå¿…è¦ãªéƒ¨åˆ†

## ğŸŸ¦ AGLæä¾›ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆæ—¢å­˜åˆ©ç”¨å¯èƒ½ï¼‰

### 1. Hardware Abstraction Layer
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | æä¾›çŠ¶æ³ | è©³ç´° |
|--------------|---------|------|
| **CAN Bus Driver** | âœ… AGLæä¾› | Linux SocketCANãƒ‰ãƒ©ã‚¤ãƒãŒæ¨™æº–æ­è¼‰ã€‚ã‚«ãƒ¼ãƒãƒ«ãƒ¬ãƒ™ãƒ«ã§CANé€šä¿¡ã‚’ã‚µãƒãƒ¼ãƒˆ |
| **OBD-II Interface** | âš ï¸ éƒ¨åˆ†æä¾› | USB-OBD-IIã‚¢ãƒ€ãƒ—ã‚¿ç”¨ã®Linuxãƒ‰ãƒ©ã‚¤ãƒã¯åˆ©ç”¨å¯èƒ½ã ãŒã€è»Šä¸¡å›ºæœ‰ã®å®Ÿè£…ãŒå¿…è¦ãªå ´åˆã‚ã‚Š |

### 2. AGL Framework Services
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | æä¾›çŠ¶æ³ | è©³ç´° |
|--------------|---------|------|
| **Application Framework Binder (AFB)** | âœ… AGLæä¾› | `afb-daemon`, WebSocket/REST API, ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å®Œå‚™ |
| **CAN Signaling Service** | âœ… AGLæä¾› | `agl-service-can-low-level` (low-can binding) - CANãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° |
| **VSS (Vehicle Signal Specification)** | âœ… AGLæä¾› | COVESA VSSã®å®Ÿè£… (`agl-vss`) ãŒåˆ©ç”¨å¯èƒ½ |
| **Wayland Compositor** | âœ… AGLæä¾› | Weston compositorãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå®Ÿè£… |
| **Window Manager** | âœ… AGLæä¾› | AGL Window Manager (`agl-compositor`) |

### 3. é–‹ç™ºãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
| ãƒ„ãƒ¼ãƒ«/ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | æä¾›çŠ¶æ³ | è©³ç´° |
|----------------|---------|------|
| **Qt Toolkit** | âœ… AGLæä¾› | Qt 5/6ãŒãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã§åˆ©ç”¨å¯èƒ½ï¼ˆWayland backendå«ã‚€ï¼‰ |
| **GTK** | âœ… AGLæä¾› | GTK+ã‚‚åˆ©ç”¨å¯èƒ½ã ãŒQtãŒæ¨å¥¨ |
| **Wayland Client Libs** | âœ… AGLæä¾› | `libwayland-client`, `wayland-protocols` |
| **GStreamer** | âœ… AGLæä¾› | ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢å‡¦ç†ç”¨ |
| **Yocto/Bitbake** | âœ… AGLæä¾› | ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ |

---

## ğŸŸ© å®Ÿè£…ãŒå¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆCarSpeedBoyé–‹ç™ºéƒ¨åˆ†ï¼‰

### 1. Data Acquisition Layerï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—å±¤ï¼‰
VSSçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒãƒ³ãƒ‰ãƒ©ã¯ä¸è¦ã§ã™ï¼š

#### **Vehicle Data Manager**
```cpp
// å®Ÿè£…ä¾‹ï¼ˆVSSãƒ™ãƒ¼ã‚¹ - ãƒ—ãƒ­ãƒˆã‚³ãƒ«éä¾å­˜ï¼‰
class VehicleDataManager {
public:
    void connectToVSS();  // AFBçµŒç”±ã§VSS bindingã«æ¥ç¶š
    void subscribeToSpeed();  // Vehicle.Speedã‚¤ãƒ™ãƒ³ãƒˆã®è³¼èª­
    double getCurrentSpeed();  // ç¾åœ¨é€Ÿåº¦ã®å–å¾—
    void handleSpeedUpdate(const json& data);  // VSSã‹ã‚‰ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†
    
private:
    AFBClient afb_client_;
    double current_speed_;
    std::chrono::system_clock::time_point last_update_;
};
```
- **VSSã®Vehicle.Speedãƒ‘ã‚¹ã‚’è³¼èª­**ï¼ˆãƒ—ãƒ­ãƒˆã‚³ãƒ«éä¾å­˜ï¼‰
- WebSocketé€šä¿¡ã®å®Ÿè£…ï¼ˆAFBçµŒç”±ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ã‚¹ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹
- ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

**VSSã‚’ä½¿ã†åˆ©ç‚¹:**
- âœ… CAN/OBD-IIãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’æ„è­˜ä¸è¦
- âœ… è»Šä¸¡ãƒ¡ãƒ¼ã‚«ãƒ¼éä¾å­˜
- âœ… å˜ä½ãŒæ¨™æº–åŒ–ï¼ˆkm/hï¼‰
- âœ… ä¿å®ˆæ€§ãŒé«˜ã„

#### **Configuration Manager**
CarSpeedBoy**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®è¨­å®š**ã‚’ç®¡ç†ã—ã¾ã™ï¼š

```cpp
class ConfigurationManager {
public:
    bool loadConfig(const std::string& config_file);
    bool saveConfig(const std::string& config_file);
    
    // é€Ÿåº¦é–¾å€¤ã®å–å¾—ãƒ»è¨­å®š
    SpeedThresholds getSpeedThresholds() const;
    void setSpeedThresholds(const SpeedThresholds& thresholds);
    
    // è¡¨ç¤ºè¨­å®š
    DisplaySettings getDisplaySettings() const;
    void setDisplaySettings(const DisplaySettings& settings);
    
    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š
    CharacterSettings getCharacterSettings() const;
    void setCharacterSettings(const CharacterSettings& settings);
    
    // AFBæ¥ç¶šè¨­å®š
    AFBConnectionConfig getAFBConfig() const;
    
    // ãƒ­ã‚°è¨­å®š
    LoggingConfig getLoggingConfig() const;
    
private:
    json config_data_;
    std::string config_file_path_;
};

struct SpeedThresholds {
    double relaxed_max;    // 0-20 km/h
    double normal_max;     // 21-60 km/h
    double alert_max;      // 61-100 km/h
    double warning_max;    // 101-120 km/h
    // 121+ km/h ã¯ scared
};
```

**Configuration Managerã®è²¬å‹™:**
- âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`config.json`ï¼‰ã®èª­ã¿æ›¸ã
- âœ… é€Ÿåº¦é–¾å€¤ã®ç®¡ç†ï¼ˆè¡¨æƒ…å¤‰åŒ–ã®ãƒˆãƒªã‚¬ãƒ¼å€¤ï¼‰
- âœ… è¡¨ç¤ºè¨­å®šï¼ˆå˜ä½è¡¨ç¤ºã€ãƒ†ãƒ¼ãƒã€è¨€èªãªã©ï¼‰
- âœ… ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆé¸æŠã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ï¼‰
- âœ… AFBæ¥ç¶šè¨­å®šï¼ˆURLã€èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
- âœ… ãƒ­ã‚°è¨­å®šï¼ˆãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã€ä¿å­˜å…ˆï¼‰
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®æ°¸ç¶šåŒ–

**Configuration ManagerãŒç®¡ç†ã—ãªã„ã‚‚ã®:**
- âŒ ãƒ—ãƒ­ãƒˆã‚³ãƒ«é¸æŠï¼ˆCAN/OBD-IIï¼‰ â† AGLãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å´ãŒç®¡ç†
- âŒ CAN ID/DBCãƒ•ã‚¡ã‚¤ãƒ« â† AGLãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å´ãŒç®¡ç†
- âŒ VSSãƒãƒƒãƒ”ãƒ³ã‚° â† AGLãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å´ãŒç®¡ç†

---

### 2. Business Logic Layerï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ï¼‰
å®Œå…¨ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®å®Ÿè£…ï¼š

#### **Speed Monitor**
```cpp
class SpeedMonitor {
    void updateSpeed(double speed);
    double getSmoothSpeed();  // ç§»å‹•å¹³å‡ã§ãƒã‚¤ã‚ºé™¤å»
    bool isSpeedValid(double speed);
};
```

#### **Expression State Machine**
```cpp
enum class ExpressionState {
    RELAXED,    // 0-20 km/h
    NORMAL,     // 21-60 km/h
    ALERT,      // 61-100 km/h
    WARNING,    // 101-120 km/h
    SCARED      // 121+ km/h
};

class ExpressionStateMachine {
    void updateState(double speed);
    ExpressionState getCurrentState();
    void applyHysteresis();  // ãƒãƒ£ã‚¿ãƒªãƒ³ã‚°é˜²æ­¢
};
```

#### **Data Logger**
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†
- CSV/JSONå‡ºåŠ›
- ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†

#### **Alert Manager**
- è­¦å‘Šãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶ã®åˆ¤å®š
- éŸ³å£°/è¦–è¦šã‚¢ãƒ©ãƒ¼ãƒˆã®åˆ¶å¾¡

---

### 3. Presentation Layerï¼ˆãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰
å…¨ã¦ã®UIå®Ÿè£…ãŒå¿…è¦ï¼š

#### **GUI Main Window**
```cpp
// Qtå®Ÿè£…ä¾‹
class MainWindow : public QMainWindow {
    Q_OBJECT
public:
    MainWindow(QWidget *parent = nullptr);
    void initWaylandSurface();
    
private slots:
    void onSpeedChanged(double speed);
};
```

#### **Character Animation Engine**
```cpp
class AnimationEngine {
    void loadCharacterAssets();
    void playAnimation(ExpressionState state);
    void updateFrame(float deltaTime);
    QPixmap getCurrentFrame();
};
```
- ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- ãƒ•ãƒ¬ãƒ¼ãƒ è£œé–“
- ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³åŠ¹æœ

#### **Speed Display Widget**
- ã‚«ã‚¹ã‚¿ãƒ Qtã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
- ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹
- æ•°å€¤è¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

#### **Settings UI**
- Qt Designer UIãƒ•ã‚¡ã‚¤ãƒ«
- è¨­å®šå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

---

### 4. Data & Configuration
#### **å®Ÿè£…ãŒå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ãƒ¼ã‚¿**
- `config.json` - é€Ÿåº¦é–¾å€¤è¨­å®š
- `characters/` - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã‚¢ã‚»ãƒƒãƒˆ
- `logs/` - ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ

---

## ğŸ“Š å®Ÿè£…ã®æ¯”ç‡

```
AGLæä¾›æ¸ˆã¿:      ç´„40%  (ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€ãƒ‰ãƒ©ã‚¤ãƒ)
å®Ÿè£…ãŒå¿…è¦:      ç´„60%  (ã‚¢ãƒ—ãƒªãƒ­ã‚¸ãƒƒã‚¯ã€UIã€ãƒ‡ãƒ¼ã‚¿å‡¦ç†)
```

### å®Ÿè£…å·¥æ•°ã®è¦‹ç©ã‚‚ã‚Š

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | å®Ÿè£…å¿…è¦åº¦ | å·¥æ•°ç›®å®‰ |
|---------|-----------|---------|
| Data Acquisition Layer | ğŸ”´ é«˜ | 2-3é€±é–“ |
| Business Logic Layer | ğŸ”´ é«˜ | 2-3é€±é–“ |
| Presentation Layer | ğŸ”´ é«˜ | 3-4é€±é–“ |
| AGLé€£æºéƒ¨åˆ† | ğŸŸ¡ ä¸­ | 1-2é€±é–“ |
| ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚° | ğŸ”´ é«˜ | 2é€±é–“ |
| **åˆè¨ˆ** | - | **10-14é€±é–“** |

## ğŸš€ é–‹ç™ºã®å„ªå…ˆé †ä½

### Phase 1: AGLé€£æºã®åŸºç¤å®Ÿè£…
1. AFB APIã¨ã®é€šä¿¡ç¢ºç«‹
2. low-can bindingã‹ã‚‰ã®é€Ÿåº¦ãƒ‡ãƒ¼ã‚¿å–å¾—
3. åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ç¢ºèª

### Phase 2: ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
4. Speed Monitorã¨State Machineã®å®Ÿè£…
5. é€Ÿåº¦é–¾å€¤ãƒ­ã‚¸ãƒƒã‚¯
6. Configuration Manager

### Phase 3: UIå®Ÿè£…
7. Qt/Waylandãƒ™ãƒ¼ã‚¹ã®åŸºæœ¬ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
8. ã‚¹ãƒ”ãƒ¼ãƒ‰è¡¨ç¤ºã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
9. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### Phase 4: çµ±åˆãƒ»æ‹¡å¼µæ©Ÿèƒ½
10. Data Loggerå®Ÿè£…
11. Settings UI
12. çµ±åˆãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°

---

## ğŸ’¡ å®Ÿè£…æ™‚ã®æ³¨æ„ç‚¹

### AGLã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€£æº
```bash
# AFB bindingã®å‘¼ã³å‡ºã—ä¾‹
afb-client-demo ws://localhost:1234/api?token=xxx

# CANãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è³¼èª­
afb-client ws://localhost:1234/api?token=xxx \
  low-can subscribe '{"event":"vehicle.speed"}'
```

### å¿…è¦ãªAGLãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```bash
# meta-agl-devel ã«å«ã¾ã‚Œã‚‹ã¹ããƒ¬ã‚·ãƒ”
IMAGE_INSTALL_append = " \
    agl-service-can-low-level \
    agl-vss \
    qtwayland \
    afb-client \
"
```

### ãƒ“ãƒ«ãƒ‰ç’°å¢ƒ
Yoctoãƒ¬ã‚·ãƒ” (`carspeedboy.bb`) ã®ä½œæˆãŒå¿…è¦ï¼š
```bitbake
inherit cmake_qt5

DEPENDS = "qtbase qtwayland afb-binding"
RDEPENDS_${PN} = "agl-service-can-low-level"
```

---

## ã¾ã¨ã‚

**AGLãŒæä¾›**: ã‚¤ãƒ³ãƒ•ãƒ©ã€ãƒ‰ãƒ©ã‚¤ãƒã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€åŸºæœ¬ã‚µãƒ¼ãƒ“ã‚¹  
**å®Ÿè£…ãŒå¿…è¦**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ã€UIã€ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«

AGLã¯ã€ŒåœŸå°ã€ã‚’æä¾›ã—ã€ãã®ä¸Šã§**CarSpeedBoyã®ç‹¬è‡ªæ©Ÿèƒ½ã‚’å…¨ã¦å®Ÿè£…**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ” è©³ç´°Q&A

### Q1: VSSã¨AFBãŒVehicle Data Managerã«æä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®é•ã„ã¯ï¼Ÿ

#### **AFB (Application Framework Binder)** ã®å½¹å‰²
AFBã¯**é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**ã§ã‚ã‚Šã€ãƒ‡ãƒ¼ã‚¿ãã®ã‚‚ã®ã§ã¯ãªã**ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ‰‹æ®µ**ã‚’æä¾›ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AFB = é€šä¿¡åŸºç›¤ (Transport Layer)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ãƒ»WebSocket/REST APIã‚µãƒ¼ãƒãƒ¼                                  â”‚
â”‚ ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»èªè¨¼                                           â”‚
â”‚ ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ï¼ˆsubscribe/unsubscribeï¼‰                        â”‚
â”‚ ãƒ»ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã®ç®¡ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**AFBãŒæä¾›ã™ã‚‹æ©Ÿèƒ½:**
- **APIå‘¼ã³å‡ºã—ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå„ç¨®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã™ãŸã‚ã®ä»•çµ„ã¿
- **ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: éåŒæœŸã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ï¼ˆpub/subï¼‰
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**: æ¨©é™ç®¡ç†ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: C/C++ã§æ›¸ã‹ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’WebSocketçµŒç”±ã§å…¬é–‹

**AFBçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ä¾‹:**
```javascript
// WebSocketçµŒç”±ã§ã®AFB APIå‘¼ã³å‡ºã—
{
  "api": "low-can",          // ã©ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰ã‹
  "verb": "subscribe",        // ã©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  "args": {
    "event": "messages.vehicle.speed"  // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  }
}
```

---

#### **VSS (Vehicle Signal Specification)** ã®å½¹å‰²
VSSã¯**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãƒ»ã‚¹ã‚­ãƒ¼ãƒå®šç¾©**ã§ã‚ã‚Šã€è»Šä¸¡ãƒ‡ãƒ¼ã‚¿ã®**æ§‹é€ ã¨æ„å‘³**ã‚’æ¨™æº–åŒ–ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VSS = ãƒ‡ãƒ¼ã‚¿å®šç¾©æ¨™æº– (Data Schema)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ãƒ»è»Šä¸¡ä¿¡å·ã®éšå±¤æ§‹é€ å®šç¾©                                       â”‚
â”‚ ãƒ»ãƒ‡ãƒ¼ã‚¿å‹ãƒ»å˜ä½ã®æ¨™æº–åŒ–                                       â”‚
â”‚ ãƒ»ãƒ¡ãƒ¼ã‚«ãƒ¼é–“ã®äº’æ›æ€§ä¿è¨¼                                       â”‚
â”‚ ãƒ»ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ï¼ˆæ„å‘³ï¼‰ã®çµ±ä¸€                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VSSæ¨™æº–ã§å®šç¾©ã•ã‚Œã‚‹æƒ…å ±:**
```yaml
# VSSå®šç¾©ä¾‹ï¼ˆYAMLå½¢å¼ï¼‰
Vehicle.Speed:
  datatype: uint16
  type: sensor
  unit: km/h
  min: 0
  max: 250
  description: "Vehicle speed"

Vehicle.Powertrain.CombustionEngine.Speed:
  datatype: uint16
  type: sensor
  unit: rpm
  description: "Engine rotational speed"

Vehicle.Body.Lights.IsHighBeamOn:
  datatype: boolean
  type: actuator
  description: "High beam status"
```

**VSSãŒæä¾›ã™ã‚‹ãƒ‡ãƒ¼ã‚¿:**
- **æ¨™æº–åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹**: `Vehicle.Speed`ã€`Vehicle.ADAS.CruiseControl.IsActive`ãªã©
- **å‹æƒ…å ±**: ãƒ‡ãƒ¼ã‚¿å‹ã€å˜ä½ã€ç¯„å›²
- **ã‚»ãƒãƒ³ãƒ†ã‚£ã‚¯ã‚¹**: å„ä¿¡å·ãŒä½•ã‚’æ„å‘³ã™ã‚‹ã‹
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**: æ›´æ–°é »åº¦ã€ã‚»ãƒ³ã‚µãƒ¼ç¨®åˆ¥ãªã©

---

#### **VSSã¨AFBã®é–¢ä¿‚æ€§**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  CarSpeedBoy Application                 â”‚
â”‚                  (Vehicle Data Manager)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ AFB WebSocket APIå‘¼ã³å‡ºã—
                       â”‚ ä¾‹: afb.call("vss", "get", {"path": "Vehicle.Speed"})
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AFB Framework (afb-daemon)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  VSS Binding (agl-vss)                             â”‚ â”‚
â”‚  â”‚  - VSSãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè£…                            â”‚ â”‚
â”‚  â”‚  - Vehicle.Speed ãªã©ã®ãƒ‘ã‚¹ã‚’ç†è§£                  â”‚ â”‚
â”‚  â”‚  - å†…éƒ¨çš„ã«low-can bindingã‚’å‘¼ã³å‡ºã—              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                   â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  low-can Binding                                   â”‚ â”‚
â”‚  â”‚  - å®Ÿéš›ã®CANãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡                        â”‚ â”‚
â”‚  â”‚  - ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆä¾‹: CAN ID 0x123, ãƒ‡ãƒ¼ã‚¿[0x1A, ...]ï¼‰ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Linux SocketCAN  â”‚
          â”‚  (CANãƒã‚¹ãƒ‰ãƒ©ã‚¤ãƒ) â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              [CANãƒã‚¹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢]
```

---

#### **ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã®é•ã„**

| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | ãƒ‡ãƒ¼ã‚¿å½¢å¼ | æŠ½è±¡åº¦ | ä½¿ç”¨ä¾‹ |
|-----------|-----------|--------|--------|
| **AFB + low-canç›´æ¥** | `{"name": "HS", "id": 291, "data": [26, 0, 0, 0, 0, 0, 0, 0]}` | ä½ï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰ | CAN ID 0x123ã‚’ç›´æ¥è³¼èª­ |
| **AFB + VSS** | `{"path": "Vehicle.Speed", "value": 26, "unit": "km/h"}` | é«˜ï¼ˆæ„å‘³çš„ï¼‰ | æ¨™æº–åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ä½¿ç”¨ |

**ä½ãƒ¬ãƒ™ãƒ«ï¼ˆlow-canç›´æ¥ï¼‰ã®ä¾‹:**
```cpp
// low-can bindingã‚’ç›´æ¥ä½¿ç”¨
afb_client.call("low-can", "subscribe", {
    "event": "messages.HS.291"  // CAN ID 291ï¼ˆ0x123ï¼‰ã‚’è³¼èª­
});

// å—ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
{
    "name": "HS",
    "id": 291,
    "data": [0x1A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
}
// â†’ ã‚¢ãƒ—ãƒªå´ã§0x1AãŒé€Ÿåº¦26km/hã ã¨è§£é‡ˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
```

**é«˜ãƒ¬ãƒ™ãƒ«ï¼ˆVSSçµŒç”±ï¼‰ã®ä¾‹:**
```cpp
// VSS bindingã‚’ä½¿ç”¨
afb_client.call("vss", "subscribe", {
    "path": "Vehicle.Speed"  // æ¨™æº–åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹
});

// å—ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿
{
    "path": "Vehicle.Speed",
    "value": 26,
    "unit": "km/h",
    "timestamp": 1699964123456
}
// â†’ ã™ã§ã«æ„å‘³ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦å–å¾—ã§ãã‚‹
```

---

#### **Vehicle Data Managerã§ã®å®Ÿè£…é¸æŠè‚¢**

##### **Option 1: VSSçµŒç”±ï¼ˆæ¨å¥¨ï¼‰**
```cpp
class VehicleDataManager {
public:
    void connectToVSS() {
        afb_client_.call("vss", "subscribe", {
            {"path", "Vehicle.Speed"}
        }, [this](const json& response) {
            double speed = response["value"];
            onSpeedUpdate(speed);  // å˜ä½å¤‰æ›ä¸è¦
        });
    }
};
```
**ãƒ¡ãƒªãƒƒãƒˆ:**
- è»Šä¸¡ãƒ¡ãƒ¼ã‚«ãƒ¼éä¾å­˜
- ãƒ‡ãƒ¼ã‚¿å‹ãƒ»å˜ä½ãŒæ¨™æº–åŒ–
- ä¿å®ˆæ€§ãŒé«˜ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- VSS bindingã®å®Ÿè£…ãŒå¿…è¦
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã‚ãšã‹ã«ä½ä¸‹ï¼ˆå¤‰æ›ãƒ¬ã‚¤ãƒ¤ãƒ¼è¿½åŠ ï¼‰

##### **Option 2: low-canç›´æ¥ï¼ˆé«˜é€Ÿã ãŒè»Šä¸¡ä¾å­˜ï¼‰**
```cpp
class VehicleDataManager {
public:
    void connectToLowCAN() {
        afb_client_.call("low-can", "subscribe", {
            {"event", "messages.HS.0x123"}  // è»Šä¸¡å›ºæœ‰ã®CAN ID
        }, [this](const json& response) {
            auto data = response["data"];
            double speed = parseSpeed(data);  // æ‰‹å‹•ãƒ‘ãƒ¼ã‚¹
            onSpeedUpdate(speed);
        });
    }
    
private:
    double parseSpeed(const std::vector<uint8_t>& data) {
        // è»Šä¸¡å›ºæœ‰ã®ãƒ“ãƒƒãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è§£æ
        return data[0];  // ç°¡æ˜“ä¾‹
    }
};
```

---

### ã¾ã¨ã‚

#### **VSS vs AFB**
- **AFB**: é€šä¿¡æ‰‹æ®µï¼ˆWebSocket APIã€ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ï¼‰
- **VSS**: ãƒ‡ãƒ¼ã‚¿ã®æ„å‘³ã¨æ§‹é€ ï¼ˆ`Vehicle.Speed`ãªã©ã®æ¨™æº–ãƒ‘ã‚¹ï¼‰
- **é–¢ä¿‚**: AFBçµŒç”±ã§VSSã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ¨™æº–åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

**CarSpeedBoyã§ã¯è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨æƒ…ï¼‰ã®ã¿ã‚’ä½¿ç”¨ã—ã€éŸ³å£°ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯å®Ÿè£…ã—ã¾ã›ã‚“ã€‚**

